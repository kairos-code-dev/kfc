# êµ¬í˜„ ë¡œë“œë§µ

## ê°œìš”

ë³¸ ë¬¸ì„œëŠ” kotlin-krx í”„ë¡œì íŠ¸ì˜ ë‹¨ê³„ë³„ êµ¬í˜„ ê³„íšì„ ì œê³µí•©ë‹ˆë‹¤. MDCSTAT04701ì„ ìµœìš°ì„ ìˆœìœ„ë¡œ í•˜ì—¬, 5ê°œì˜ ì£¼ìš” ë‹¨ê³„(Phase)ë¡œ ë‚˜ëˆ„ì–´ ì²´ê³„ì ì¸ ê°œë°œì„ ì§„í–‰í•©ë‹ˆë‹¤.

**ì „ì²´ ê°œë°œ ê¸°ê°„ ì˜ˆìƒ**: 4-6ì£¼

---

## Phase 1: MDCSTAT04701 êµ¬í˜„ (ìµœìš°ì„  ìˆœìœ„) ğŸ”¥

**ëª©í‘œ**: ETF ê°œë³„ì¢…ëª© ì¢…í•©ì •ë³´ ì—”ë“œí¬ì¸íŠ¸ ì™„ì „ êµ¬í˜„

**ê¸°ê°„**: 1-2ì£¼

**ë³µì¡ë„**: ì¤‘ê°„

### ì‘ì—… ë¶„ë¥˜

#### 1.1 ì •ê·œí™” ìœ í‹¸ë¦¬í‹° êµ¬í˜„

**íŒŒì¼**: `/app/src/main/kotlin/com/kairos/krx/util/NormalizationExtensions.kt`

**ì‘ì—… ë‚´ìš©**:
- `String.toKrxInt()` êµ¬í˜„
- `String.toKrxLong()` êµ¬í˜„
- `String.toKrxSignedLong()` êµ¬í˜„
- `String.toKrxDouble()` êµ¬í˜„
- `String.toKrxBigDecimal()` êµ¬í˜„
- `String.toKrxDate()` êµ¬í˜„
- `String.toKrxDirection()` ë° `Direction` Enum êµ¬í˜„

**ì˜ˆìƒ ì‹œê°„**: 2ì¼

**í…ŒìŠ¤íŠ¸**:
- `/app/src/test/kotlin/com/kairos/krx/util/NormalizationExtensionsTest.kt`
- ëª¨ë“  ì—£ì§€ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸ (20ê°œ ì´ìƒ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤)

**ì™„ë£Œ ê¸°ì¤€**:
- âœ… ëª¨ë“  ì •ê·œí™” í•¨ìˆ˜ êµ¬í˜„
- âœ… ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ 100%
- âœ… íŠ¹ìˆ˜ ê°’ ì²˜ë¦¬ ê²€ì¦ ("-", "", null)

---

#### 1.2 ComprehensiveEtfInfo ëª¨ë¸ ìƒì„±

**íŒŒì¼**: `/app/src/main/kotlin/com/kairos/krx/model/ComprehensiveEtfInfo.kt`

**ì‘ì—… ë‚´ìš©**:
- 30ê°œ ì´ìƒ í•„ë“œë¥¼ ê°€ì§„ ë°ì´í„° í´ë˜ìŠ¤ ì •ì˜
- `companion object`ì— `fromRaw(raw: Map<*, *>)` íŒ©í† ë¦¬ ë©”ì„œë“œ êµ¬í˜„
- í—¬í¼ ë©”ì„œë“œ ì¶”ê°€:
  - `isNear52WeekHigh()`: 52ì£¼ ê³ ê°€ 95% ì´ìƒ
  - `isNear52WeekLow()`: 52ì£¼ ì €ê°€ 105% ì´í•˜
  - `hasExcessiveDivergence()`: ê´´ë¦¬ìœ¨ ì ˆëŒ€ê°’ 1% ì´ìƒ
  - `hasLowFee()`: ì´ ë³´ìˆ˜ 0.3% ì´í•˜

**ì˜ˆìƒ ì‹œê°„**: 1ì¼

**ì™„ë£Œ ê¸°ì¤€**:
- âœ… ëª¨ë“  í•„ë“œ ì •ì˜ ì™„ë£Œ
- âœ… `fromRaw()` ì •ìƒ ë™ì‘
- âœ… KDoc ì£¼ì„ ì‘ì„±

**ë°ì´í„° í´ë˜ìŠ¤ êµ¬ì¡°**:
```kotlin
data class ComprehensiveEtfInfo(
    // ê¸°ë³¸ ì‹ë³„ (5ê°œ)
    val tradeDate: LocalDate,
    val isin: String,
    val ticker: String,
    val name: String,
    val fullName: String,

    // OHLCV (8ê°œ)
    val openPrice: Int,
    val highPrice: Int,
    val lowPrice: Int,
    val closePrice: Int,
    val priceChange: Int,
    val priceChangeDirection: Int,
    val priceChangeRate: Double,

    // ê±°ë˜ (2ê°œ)
    val volume: Long,
    val tradingValue: Long,

    // NAV (4ê°œ)
    val nav: BigDecimal,
    val navChange: BigDecimal,
    val navChangeRate: Double,
    val divergenceRate: Double,

    // ì‹œê°€ì´ì•¡ (3ê°œ)
    val marketCap: Long,
    val netAssetValue: Long,
    val listedShares: Long,

    // 52ì£¼ ê³ ì € (4ê°œ) - í•µì‹¬
    val week52High: Int,
    val week52HighDate: LocalDate,
    val week52Low: Int,
    val week52LowDate: LocalDate,

    // ì§€ìˆ˜ (5ê°œ)
    val indexValue: BigDecimal,
    val indexName: String,
    val indexChange: BigDecimal,
    val indexChangeDirection: Int,
    val indexChangeRate: Double,

    // ETF ê¸°ë³¸ ì •ë³´ (10ê°œ)
    val listingDate: LocalDate,
    val assetManager: String,
    val totalFee: BigDecimal,  // í•µì‹¬
    val creationUnit: Long,
    val benchmarkIndex: String,
    val indexProvider: String,
    val marketClassification: String,
    val assetClass: String,  // í•µì‹¬
    val replicationMethod: String,
    val leverageType: String,
    val taxType: String,
    val marketName: String
)
```

---

#### 1.3 EtfComprehensiveService ì„œë¹„ìŠ¤ êµ¬í˜„

**íŒŒì¼**: `/app/src/main/kotlin/com/kairos/krx/etx/EtfComprehensiveService.kt`

**ì‘ì—… ë‚´ìš©**:
- `@Service` ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€
- `KrxClient` ë° `EtxTickerCache` ì˜ì¡´ì„± ì£¼ì…
- `getComprehensiveInfo(ticker: String, date: LocalDate)` êµ¬í˜„
- `getComprehensiveInfoMultiple(tickers: List<String>, date: LocalDate)` êµ¬í˜„
- í—¬í¼ ë©”ì„œë“œ:
  - `getLowFeeEtfs()`: ì €ë³´ìˆ˜ ETF í•„í„°ë§
  - `getEtfsNear52WeekHigh()`: 52ì£¼ ê³ ê°€ ê·¼ì²˜ ETF
  - `getEtfsNear52WeekLow()`: 52ì£¼ ì €ê°€ ê·¼ì²˜ ETF

**ì˜ˆìƒ ì‹œê°„**: 2ì¼

**ì™„ë£Œ ê¸°ì¤€**:
- âœ… ëª¨ë“  ë©”ì„œë“œ êµ¬í˜„
- âœ… ì˜¤ë¥˜ ì²˜ë¦¬ (TickerNotFoundException, KrxApiException)
- âœ… ë¡œê¹… ì¶”ê°€
- âœ… KDoc ì£¼ì„ ì‘ì„±

**ì„œë¹„ìŠ¤ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜**:
```kotlin
@Service
class EtfComprehensiveService(
    private val client: KrxClient,
    private val tickerCache: EtxTickerCache
) {
    fun getComprehensiveInfo(
        ticker: String,
        date: LocalDate = LocalDate.now()
    ): ComprehensiveEtfInfo?

    fun getComprehensiveInfoMultiple(
        tickers: List<String>,
        date: LocalDate = LocalDate.now()
    ): Map<String, ComprehensiveEtfInfo>

    fun getLowFeeEtfs(
        tickers: List<String>,
        date: LocalDate = LocalDate.now()
    ): List<ComprehensiveEtfInfo>

    fun getEtfsNear52WeekHigh(
        tickers: List<String>,
        date: LocalDate = LocalDate.now()
    ): List<ComprehensiveEtfInfo>
}
```

---

#### 1.4 í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±

**íŒŒì¼**: `/app/src/test/kotlin/com/kairos/krx/integration/Mdcstat04701IntegrationTest.kt`

**ì‘ì—… ë‚´ìš©**:
- ì‹¤ì œ KRX APIì™€ í†µí•© í…ŒìŠ¤íŠ¸
- ëŒ€í‘œ ETF í‹°ì»¤ ì‚¬ìš© (KODEX 200, TIGER 200 ë“±)
- ë‹¤ì–‘í•œ ë‚ ì§œ í…ŒìŠ¤íŠ¸ (ìµœê·¼ ê±°ë˜ì¼, ê³¼ê±° ë‚ ì§œ)
- í•„ë“œ ê²€ì¦:
  - ê°€ê²© ë°ì´í„° ì •í•©ì„± (ê³ ê°€ >= ì¢…ê°€ >= ì €ê°€)
  - 52ì£¼ ê³ ê°€/ì €ê°€ ë²”ìœ„ ê²€ì¦
  - ì´ ë³´ìˆ˜ ìœ íš¨ì„± ê²€ì¦
  - ìì‚°êµ° ìœ íš¨ì„± ê²€ì¦

**ì˜ˆìƒ ì‹œê°„**: 2ì¼

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:
1. ì •ìƒ ì¡°íšŒ (ìµœê·¼ ê±°ë˜ì¼)
2. ê³¼ê±° ë‚ ì§œ ì¡°íšŒ
3. ì—¬ëŸ¬ ETF ë™ì‹œ ì¡°íšŒ
4. ì €ë³´ìˆ˜ ETF í•„í„°ë§
5. 52ì£¼ ê³ ê°€/ì €ê°€ ê·¼ì²˜ í•„í„°ë§
6. ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í‹°ì»¤ ì˜¤ë¥˜ ì²˜ë¦¬
7. íœ´ì¼ ë‚ ì§œ ì˜¤ë¥˜ ì²˜ë¦¬

**ì™„ë£Œ ê¸°ì¤€**:
- âœ… 7ê°œ ì´ìƒ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì‘ì„±
- âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼
- âœ… ì‹¤ì œ KRX API ì‘ë‹µ ê²€ì¦

---

#### 1.5 ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ í†µí•©

**ì‘ì—… ë‚´ìš©**:
- ê¸°ì¡´ `EtfService`ì— `EtfComprehensiveService` ì°¸ì¡° ì¶”ê°€ (ì˜µì…˜)
- REST Controller ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ (ì˜µì…˜)
- ë¬¸ì„œí™” ì—…ë°ì´íŠ¸

**ì˜ˆìƒ ì‹œê°„**: 1ì¼

**REST API ì˜ˆì œ** (ì˜µì…˜):
```kotlin
@RestController
@RequestMapping("/api/v1/etf")
class EtfController(
    private val comprehensiveService: EtfComprehensiveService
) {
    @GetMapping("/{ticker}/comprehensive")
    fun getComprehensive(
        @PathVariable ticker: String,
        @RequestParam(required = false) date: String?
    ): ComprehensiveEtfInfo {
        val tradeDate = date?.let { LocalDate.parse(it) } ?: LocalDate.now()
        return comprehensiveService.getComprehensiveInfo(ticker, tradeDate)
            ?: throw ResponseStatusException(HttpStatus.NOT_FOUND)
    }
}
```

---

### Phase 1 ì™„ë£Œ ê¸°ì¤€

- âœ… MDCSTAT04701 ì—”ë“œí¬ì¸íŠ¸ ì™„ì „ ì‘ë™
- âœ… ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ > 80%
- âœ… í†µí•© í…ŒìŠ¤íŠ¸ ëª¨ë‘ í†µê³¼
- âœ… ê¸°ìˆ  ë¬¸ì„œ ì—…ë°ì´íŠ¸
- âœ… ì½”ë“œ ë¦¬ë·° ì™„ë£Œ

### Phase 1 ì‚°ì¶œë¬¼

| íŒŒì¼ | íƒ€ì… | ìƒíƒœ |
|-----|------|------|
| `NormalizationExtensions.kt` | ìœ í‹¸ë¦¬í‹° | âœ… |
| `NormalizationExtensionsTest.kt` | í…ŒìŠ¤íŠ¸ | âœ… |
| `ComprehensiveEtfInfo.kt` | ëª¨ë¸ | âœ… |
| `EtfComprehensiveService.kt` | ì„œë¹„ìŠ¤ | âœ… |
| `Mdcstat04701IntegrationTest.kt` | í†µí•© í…ŒìŠ¤íŠ¸ | âœ… |

---

## Phase 2: ê³µë§¤ë„ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„

**ëª©í‘œ**: ê³µë§¤ë„ í†µê³„ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„ (MDCSTAT31401, MDCSTAT31501)

**ê¸°ê°„**: 1ì£¼

**ë³µì¡ë„**: ì¤‘ê°„

### ì‘ì—… ë¶„ë¥˜

#### 2.1 ê³µë§¤ë„ ë°ì´í„° ëª¨ë¸ ìƒì„±

**íŒŒì¼**:
- `/app/src/main/kotlin/com/kairos/krx/model/ShortSellingTransaction.kt`
- `/app/src/main/kotlin/com/kairos/krx/model/ShortSellingBalance.kt`

**ì‘ì—… ë‚´ìš©**:
- `ShortSellingTransaction` ë°ì´í„° í´ë˜ìŠ¤ ì •ì˜
- `ShortSellingBalance` ë°ì´í„° í´ë˜ìŠ¤ ì •ì˜
- `fromRaw()` íŒ©í† ë¦¬ ë©”ì„œë“œ êµ¬í˜„

**ì˜ˆìƒ ì‹œê°„**: 1ì¼

---

#### 2.2 ê³µë§¤ë„ ì„œë¹„ìŠ¤ êµ¬í˜„

**íŒŒì¼**: `/app/src/main/kotlin/com/kairos/krx/shortselling/ShortSellingService.kt`

**ì‘ì—… ë‚´ìš©**:
- MDCSTAT31401 (ê³µë§¤ë„ ê±°ë˜) ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
- MDCSTAT31501 (ê³µë§¤ë„ ì¢…í•©ì •ë³´) ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
- í—¬í¼ ë©”ì„œë“œ:
  - `getShortSellingTransactions()`: ê³µë§¤ë„ ê±°ë˜ ì¡°íšŒ
  - `getShortSellingBalance()`: ê³µë§¤ë„ ì”ê³  ì¡°íšŒ
  - `getHighShortSellingRatioStocks()`: ë†’ì€ ê³µë§¤ë„ ë¹„ì¤‘ ì¢…ëª© í•„í„°ë§

**ì˜ˆìƒ ì‹œê°„**: 2ì¼

---

#### 2.3 í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±

**íŒŒì¼**: `/app/src/test/kotlin/com/kairos/krx/integration/ShortSellingIntegrationTest.kt`

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:
1. ê³µë§¤ë„ ê±°ë˜ ë°ì´í„° ì¡°íšŒ (ì‚¼ì„±ì „ì ë“±)
2. ê³µë§¤ë„ ì”ê³  ì¶”ì´ ì¡°íšŒ
3. ë†’ì€ ê³µë§¤ë„ ë¹„ì¤‘ ì¢…ëª© í•„í„°ë§
4. ê³µë§¤ë„ ìˆœê±°ë˜ëŸ‰ ê³„ì‚° ê²€ì¦
5. ì”ê³  ë¹„ìœ¨ ê³„ì‚° ê²€ì¦

**ì˜ˆìƒ ì‹œê°„**: 2ì¼

---

### Phase 2 ì™„ë£Œ ê¸°ì¤€

- âœ… ê³µë§¤ë„ ì—”ë“œí¬ì¸íŠ¸ 2ê°œ êµ¬í˜„
- âœ… í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ > 80%
- âœ… ë¬¸ì„œ ì—…ë°ì´íŠ¸

---

## Phase 3: ë„¤ì´ë²„ API í†µí•© (ì¡°ì •ì£¼ê°€ ì§€ì›)

**ëª©í‘œ**: ë„¤ì´ë²„ ì¦ê¶Œ API í†µí•©ìœ¼ë¡œ ì¡°ì •ì£¼ê°€ ì œê³µ

**ê¸°ê°„**: 3-5ì¼

**ë³µì¡ë„**: ì¤‘ê°„

### ì‘ì—… ë¶„ë¥˜

#### 3.1 NaverClient êµ¬í˜„

**íŒŒì¼**: `/app/src/main/kotlin/com/kairos/krx/client/NaverClient.kt`

**ì‘ì—… ë‚´ìš©**:
- ë„¤ì´ë²„ ì°¨íŠ¸ API í˜¸ì¶œ ë¡œì§ (`fchart.stock.naver.com/sise.nhn`)
- XML ì‘ë‹µ íŒŒì‹± (javax.xml ì‚¬ìš©)
- HTTP í´ë¼ì´ì–¸íŠ¸ ì„¤ì • (OkHttp)
- User-Agent, Referer í—¤ë” ì„¤ì •

**ì˜ˆìƒ ì‹œê°„**: 2ì¼

---

#### 3.2 ì—ëŸ¬ ì²˜ë¦¬ ë° ì¬ì‹œë„ ë¡œì§

**ì‘ì—… ë‚´ìš©**:
- `NaverApiException` ì˜ˆì™¸ í´ë˜ìŠ¤ ì •ì˜
- ì¬ì‹œë„ ë¡œì§ (ìµœëŒ€ 3íšŒ, Exponential backoff)
- Rate Limiting (Guava RateLimiter, ì´ˆë‹¹ 10 ìš”ì²­)
- í´ë°± ì „ëµ (ë„¤ì´ë²„ ì‹¤íŒ¨ ì‹œ KRX ì›ë³¸ ë°˜í™˜)

**ì˜ˆìƒ ì‹œê°„**: 1ì¼

---

#### 3.3 ê¸°ì¡´ ì„œë¹„ìŠ¤ í†µí•©

**íŒŒì¼**: `/app/src/main/kotlin/com/kairos/krx/service/EtfService.kt`

**ì‘ì—… ë‚´ìš©**:
- `getOhlcv()` í•¨ìˆ˜ì— `adjusted: Boolean = false` íŒŒë¼ë¯¸í„° ì¶”ê°€
- `HistoricalDataService.getHistoricalOhlcv()`ì—ë„ ë™ì¼í•˜ê²Œ ì¶”ê°€
- adjusted=true ì‹œ NaverClient ì‚¬ìš©
- adjusted=false ì‹œ KrxClient ì‚¬ìš© (ê¸°ì¡´ ë¡œì§)

**ì˜ˆìƒ ì‹œê°„**: 1ì¼

---

#### 3.4 í…ŒìŠ¤íŠ¸ ì‘ì„±

**íŒŒì¼**:
- `/app/src/test/kotlin/com/kairos/krx/client/NaverClientTest.kt`
- `/app/src/test/kotlin/com/kairos/krx/integration/AdjustedPriceIntegrationTest.kt`

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:
1. ì¡°ì •ì£¼ê°€ ì¡°íšŒ ì„±ê³µ (KODEX 200)
2. ì˜ëª»ëœ í‹°ì»¤ë¡œ ì¡°íšŒ ì‹œ ì˜ˆì™¸ ë°œìƒ
3. ë„¤ì´ë²„ ì‹¤íŒ¨ ì‹œ KRX í´ë°± ë™ì‘ ê²€ì¦
4. Rate Limiting ë™ì‘ ê²€ì¦
5. ì¬ì‹œë„ ë¡œì§ ê²€ì¦

**ì˜ˆìƒ ì‹œê°„**: 1-2ì¼

---

### Phase 3 ì™„ë£Œ ê¸°ì¤€

- âœ… NaverClient êµ¬í˜„ ì™„ë£Œ
- âœ… EtfServiceì— adjusted íŒŒë¼ë¯¸í„° ì¶”ê°€
- âœ… ì—ëŸ¬ ì²˜ë¦¬ ë° í´ë°± ë¡œì§ ë™ì‘
- âœ… í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ > 80%
- âœ… 09-ë„¤ì´ë²„-API-í†µí•©-ëª…ì„¸.md ë¬¸ì„œ ì°¸ê³ í•˜ì—¬ êµ¬í˜„

**ì°¸ê³  ë¬¸ì„œ**: `plan/09-ë„¤ì´ë²„-API-í†µí•©-ëª…ì„¸.md`

---

## Phase 4: ë°±í…ŒìŠ¤íŠ¸ ì§€ì› ê°•í™”

**ëª©í‘œ**: ë°±í…ŒìŠ¤íŒ…ì— ìµœì í™”ëœ API ë° ìœ í‹¸ë¦¬í‹° êµ¬í˜„

**ê¸°ê°„**: 1-2ì£¼

**ë³µì¡ë„**: ë†’ìŒ

### ì‘ì—… ë¶„ë¥˜

#### 3.1 ìœ ì—°í•œ ë‚ ì§œ ë²”ìœ„ API ì„¤ê³„

**ì‘ì—… ë‚´ìš©**:
- `getHistoricalData(ticker: String, from: LocalDate?, to: LocalDate?)` êµ¬í˜„
- `from = null`ì¸ ê²½ìš° ìƒì¥ì¼ ìë™ ê°ì§€
- `to = null`ì¸ ê²½ìš° ìµœê·¼ ê±°ë˜ì¼ ìë™ ì„¤ì •

**ì˜ˆìƒ ì‹œê°„**: 2ì¼

**API ì‹œê·¸ë‹ˆì²˜**:
```kotlin
interface HistoricalDataService {
    /**
     * ê³¼ê±° OHLCV ë°ì´í„° ì¡°íšŒ
     * @param ticker í‹°ì»¤
     * @param from ì‹œì‘ì¼ (null = ìƒì¥ì¼)
     * @param to ì¢…ë£Œì¼ (null = ìµœê·¼ ê±°ë˜ì¼)
     */
    fun getHistoricalOhlcv(
        ticker: String,
        from: LocalDate? = null,
        to: LocalDate? = null
    ): List<Ohlcv>

    /**
     * ê³¼ê±° NAV ë°ì´í„° ì¡°íšŒ
     */
    fun getHistoricalNav(
        ticker: String,
        from: LocalDate? = null,
        to: LocalDate? = null
    ): List<NavData>

    /**
     * ê³¼ê±° ê´´ë¦¬ìœ¨ ë°ì´í„° ì¡°íšŒ
     */
    fun getHistoricalDivergence(
        ticker: String,
        from: LocalDate? = null,
        to: LocalDate? = null
    ): List<DivergenceData>
}
```

---

#### 3.2 ìë™ 730ì¼ ë¶„í•  ë¡œì§

**ì‘ì—… ë‚´ìš©**:
- KrxClientì— ë‚ ì§œ ë²”ìœ„ ë¶„í•  ë¡œì§ êµ¬í˜„
- 730ì¼ ì´ˆê³¼ ì‹œ ìë™ìœ¼ë¡œ ì—¬ëŸ¬ ì²­í¬ë¡œ ë¶„í• 
- ê° ì²­í¬ë¥¼ ìˆœì°¨ ìš”ì²­ (1ì´ˆ ì§€ì—°)
- ê²°ê³¼ ë³‘í•©

**ì˜ˆìƒ ì‹œê°„**: 3ì¼

**êµ¬í˜„ ìœ„ì¹˜**: `/app/src/main/kotlin/com/kairos/krx/client/KrxClient.kt`

**ì•Œê³ ë¦¬ì¦˜**:
```kotlin
fun postWithDateRange(
    bld: String,
    params: Map<String, String>,
    startDate: LocalDate,
    endDate: LocalDate
): List<Map<String, Any?>> {
    val chunks = splitDateRange(startDate, endDate, 730)
    val results = mutableListOf<Map<String, Any?>>()

    chunks.forEach { (start, end) ->
        val chunkParams = params + mapOf(
            "strtDd" to start.format(yyyyMMdd),
            "endDd" to end.format(yyyyMMdd)
        )
        val response = post(bld, chunkParams)
        results.addAll(extractOutput(response))

        // ì†ë„ ì œí•œ
        if (chunks.size > 1) Thread.sleep(1000)
    }

    return results
}

private fun splitDateRange(
    start: LocalDate,
    end: LocalDate,
    maxDays: Int
): List<Pair<LocalDate, LocalDate>> {
    val chunks = mutableListOf<Pair<LocalDate, LocalDate>>()
    var current = start

    while (current.isBefore(end)) {
        val chunkEnd = minOf(current.plusDays(maxDays.toLong()), end)
        chunks.add(current to chunkEnd)
        current = chunkEnd.plusDays(1)
    }

    return chunks
}
```

---

#### 3.3 ìƒì¥ì¼ ìë™ ê°ì§€

**ì‘ì—… ë‚´ìš©**:
- MDCSTAT04601 (ê¸°ë³¸ ì •ë³´) ì¡°íšŒí•˜ì—¬ ìƒì¥ì¼ ì¶”ì¶œ
- ìºì‹±ìœ¼ë¡œ ì¤‘ë³µ ì¡°íšŒ ë°©ì§€

**ì˜ˆìƒ ì‹œê°„**: 1ì¼

**êµ¬í˜„**:
```kotlin
class ListingDateCache(
    private val basicInfoService: EtfBasicInfoService
) {
    private val cache = mutableMapOf<String, LocalDate>()

    fun getListingDate(ticker: String): LocalDate {
        return cache.getOrPut(ticker) {
            basicInfoService.getBasicInfo(ticker)?.listingDate
                ?: throw TickerNotFoundException("Cannot find listing date for $ticker")
        }
    }
}
```

---

#### 3.4 ë°ì´í„° ë³‘í•© ìœ í‹¸ë¦¬í‹°

**ì‘ì—… ë‚´ìš©**:
- ì—¬ëŸ¬ ì²­í¬ì˜ ê²°ê³¼ë¥¼ í•˜ë‚˜ì˜ ë¦¬ìŠ¤íŠ¸ë¡œ ë³‘í•©
- ë‚ ì§œ ê¸°ì¤€ ì •ë ¬
- ì¤‘ë³µ ì œê±°

**ì˜ˆìƒ ì‹œê°„**: 1ì¼

**êµ¬í˜„**:
```kotlin
object DataMerger {
    fun <T> mergeByDate(
        chunks: List<List<T>>,
        dateExtractor: (T) -> LocalDate
    ): List<T> {
        return chunks.flatten()
            .distinctBy { dateExtractor(it) }
            .sortedBy { dateExtractor(it) }
    }
}
```

---

#### 3.5 ë°±í…ŒìŠ¤íŠ¸ í—¬í¼ í•¨ìˆ˜

**ì‘ì—… ë‚´ìš©**:
- ìˆ˜ìµë¥  ê³„ì‚° í•¨ìˆ˜
- ìµœëŒ€ ë‚™í­ (MDD) ê³„ì‚°
- ìƒ¤í”„ ë¹„ìœ¨ ê³„ì‚°
- ë³€ë™ì„± ê³„ì‚°

**ì˜ˆìƒ ì‹œê°„**: 2ì¼

**êµ¬í˜„**:
```kotlin
object BacktestUtils {
    fun calculateReturns(prices: List<Int>): List<Double>

    fun calculateMaxDrawdown(prices: List<Int>): Double

    fun calculateSharpeRatio(returns: List<Double>, riskFreeRate: Double): Double

    fun calculateVolatility(returns: List<Double>): Double
}
```

---

### Phase 3 ì™„ë£Œ ê¸°ì¤€

- âœ… ìœ ì—°í•œ ë‚ ì§œ ë²”ìœ„ API ì‘ë™
- âœ… 730ì¼ ìë™ ë¶„í•  ê²€ì¦
- âœ… ìƒì¥ì¼ë¶€í„° í˜„ì¬ê¹Œì§€ ë°ì´í„° ì¡°íšŒ ê°€ëŠ¥
- âœ… ë°±í…ŒìŠ¤íŠ¸ í—¬í¼ í•¨ìˆ˜ êµ¬í˜„
- âœ… ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (5ë…„ ë°ì´í„° < 30ì´ˆ)

---

## Phase 5: ë‚˜ë¨¸ì§€ pykrx í˜¸í™˜ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„

**ëª©í‘œ**: pykrxì™€ 1:1 í˜¸í™˜ì„± ë‹¬ì„±

**ê¸°ê°„**: 2ì£¼

**ë³µì¡ë„**: ì¤‘ê°„-ë†’ìŒ

### ì‘ì—… ë¶„ë¥˜

#### 4.1 pykrx ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡ ì‘ì„±

**ì´ë¯¸ êµ¬í˜„ëœ ì—”ë“œí¬ì¸íŠ¸**:
- âœ… finder_secuprodisu (í‹°ì»¤ ê²€ìƒ‰)
- âœ… MDCSTAT04601 (ê¸°ë³¸ ì •ë³´)
- âœ… MDCSTAT04501 (OHLCV)
- âœ… MDCSTAT04701 (ì¢…í•© ì •ë³´) - pykrxì— ì—†ìŒ
- âœ… MDCSTAT05001 (PDF)
- âœ… MDCSTAT04801~04902 (íˆ¬ìì ê±°ë˜)
- âœ… MDCSTAT05901 (ì¶”ì  ì˜¤ì°¨)
- âœ… MDCSTAT06001 (ê´´ë¦¬ìœ¨)

**êµ¬í˜„ í•„ìš”**:
- MDCSTAT04301 (ì „ì¢…ëª© ì‹œì„¸)
- MDCSTAT04401 (ì „ì¢…ëª© ë“±ë½ë¥ )

---

#### 4.2 ê° ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„

**í‘œì¤€ í”„ë¡œì„¸ìŠ¤** (ì—”ë“œí¬ì¸íŠ¸ë‹¹):
1. ëª¨ë¸ í´ë˜ìŠ¤ ìƒì„± (1ì‹œê°„)
2. ì„œë¹„ìŠ¤ ë©”ì„œë“œ êµ¬í˜„ (2ì‹œê°„)
3. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± (1ì‹œê°„)
4. í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„± (1ì‹œê°„)
5. ë¬¸ì„œ ì—…ë°ì´íŠ¸ (30ë¶„)

**ì´ ì˜ˆìƒ ì‹œê°„**: ì—”ë“œí¬ì¸íŠ¸ë‹¹ 0.5-1ì¼

---

#### 4.3 pykrx ì¶œë ¥ ë¹„êµ í…ŒìŠ¤íŠ¸

**ì‘ì—… ë‚´ìš©**:
- pykrx Python ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
- kotlin-krx Kotlin ì½”ë“œ ì‹¤í–‰
- ì¶œë ¥ ë¹„êµ (í•„ë“œëª…, ê°’)
- ë¶ˆì¼ì¹˜ ìˆ˜ì •

**ì˜ˆìƒ ì‹œê°„**: 3ì¼

**ë¹„êµ ìŠ¤í¬ë¦½íŠ¸**:
```python
# scripts/compare_pykrx.py
from pykrx import etx
import json

ticker = "152100"
date = "20240102"

# pykrx ì¶œë ¥
pykrx_result = etx.get_etf_ohlcv_by_date(date, date, ticker)
print(json.dumps(pykrx_result.to_dict()))
```

```kotlin
// scripts/CompareKotlinKrx.kt
fun main() {
    val service = EtfService(...)
    val result = service.getEtfOhlcvByDate("20240102", "20240102", "152100")
    println(Json.encodeToString(result))
}
```

---

### Phase 4 ì™„ë£Œ ê¸°ì¤€

- âœ… pykrxì˜ ëª¨ë“  ETF ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
- âœ… ì¶œë ¥ 1:1 ì¼ì¹˜ ê²€ì¦
- âœ… í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ > 80%
- âœ… ì„±ëŠ¥ ë™ë“± ì´ìƒ

---

## Phase 6: ì™„ì „í•œ í…ŒìŠ¤íŠ¸ ë° ë¬¸ì„œí™”

**ëª©í‘œ**: í”„ë¡œë•ì…˜ ì¤€ë¹„ ì™„ë£Œ

**ê¸°ê°„**: 1ì£¼

**ë³µì¡ë„**: ì¤‘ê°„

### ì‘ì—… ë¶„ë¥˜

#### 5.1 í¬ê´„ì ì¸ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

**ì‘ì—… ë‚´ìš©**:
- ëª¨ë“  ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ í…ŒìŠ¤íŠ¸
- ëª¨ë“  ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
- ì—£ì§€ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸
- Mock ê°ì²´ ì‚¬ìš©

**ëª©í‘œ ì»¤ë²„ë¦¬ì§€**: > 85%

**ì˜ˆìƒ ì‹œê°„**: 3ì¼

---

#### 5.2 í†µí•© í…ŒìŠ¤íŠ¸ í™•ì¥

**ì‘ì—… ë‚´ìš©**:
- ì—”ë“œí¬ì¸íŠ¸ë³„ í†µí•© í…ŒìŠ¤íŠ¸
- ëŒ€í‘œ ETF í‹°ì»¤ë¡œ ì „ì²´ ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸
- ì˜¤ë¥˜ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ (íœ´ì¼, ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í‹°ì»¤ ë“±)

**ì˜ˆìƒ ì‹œê°„**: 2ì¼

---

#### 5.3 ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

**ì‘ì—… ë‚´ìš©**:
- ëŒ€ëŸ‰ ë°ì´í„° ì¡°íšŒ ì„±ëŠ¥ ì¸¡ì •
- 730ì¼ ë¶„í•  ì„±ëŠ¥ ê²€ì¦
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í”„ë¡œíŒŒì¼ë§
- ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸

**ì„±ëŠ¥ ëª©í‘œ**:
- ë‹¨ì¼ ë‚ ì§œ ì¿¼ë¦¬: < 2ì´ˆ
- 730ì¼ ë²”ìœ„: < 10ì´ˆ
- 5ë…„ ë°ì´í„°: < 30ì´ˆ

**ì˜ˆìƒ ì‹œê°„**: 2ì¼

---

#### 5.4 API ë¬¸ì„œ ìƒì„±

**ì‘ì—… ë‚´ìš©**:
- KDoc ì£¼ì„ ì™„ì„±ë„ ê²€ì¦
- Dokkaë¡œ HTML ë¬¸ì„œ ìƒì„±
- README.md ì—…ë°ì´íŠ¸
- ì‚¬ìš© ì˜ˆì œ ì¶”ê°€

**ì˜ˆìƒ ì‹œê°„**: 2ì¼

---

#### 5.5 ì‚¬ìš©ì ê°€ì´ë“œ ì‘ì„±

**ì‘ì—… ë‚´ìš©**:
- ì‹œì‘ ê°€ì´ë“œ (Getting Started)
- ì¼ë°˜ì ì¸ ì‚¬ìš© ì‚¬ë¡€
- ë¬¸ì œ í•´ê²° (Troubleshooting)
- FAQ

**ì˜ˆìƒ ì‹œê°„**: 2ì¼

---

### Phase 5 ì™„ë£Œ ê¸°ì¤€

- âœ… ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ > 85%
- âœ… ëª¨ë“  í†µí•© í…ŒìŠ¤íŠ¸ í†µê³¼
- âœ… ì„±ëŠ¥ ëª©í‘œ ë‹¬ì„±
- âœ… ì™„ì „í•œ API ë¬¸ì„œ
- âœ… ì‚¬ìš©ì ê°€ì´ë“œ ì™„ì„±

---

## ì „ì²´ ë§ˆì¼ìŠ¤í†¤

| Phase | ëª©í‘œ | ê¸°ê°„ | ì™„ë£Œ ê¸°ì¤€ |
|-------|------|------|----------|
| **Phase 1** | MDCSTAT04701 êµ¬í˜„ | 1-2ì£¼ | ì¢…í•© ì •ë³´ ì—”ë“œí¬ì¸íŠ¸ ì™„ì „ ì‘ë™ |
| **Phase 2** | ì¶”ê°€ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„ | 1ì£¼ | pykrx ë¯¸êµ¬í˜„ ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ |
| **Phase 3** | ë°±í…ŒìŠ¤íŠ¸ ì§€ì› | 1-2ì£¼ | ìœ ì—°í•œ ê³¼ê±° ë°ì´í„° API |
| **Phase 4** | pykrx í˜¸í™˜ì„± | 2ì£¼ | 1:1 ì¶œë ¥ ì¼ì¹˜ |
| **Phase 5** | í…ŒìŠ¤íŠ¸ ë° ë¬¸ì„œí™” | 1ì£¼ | í”„ë¡œë•ì…˜ ì¤€ë¹„ ì™„ë£Œ |

**ì „ì²´ ê¸°ê°„**: 6-8ì£¼

---

## ë¦¬ìŠ¤í¬ ë° ëŒ€ì‘ ë°©ì•ˆ

### ë¦¬ìŠ¤í¬ 1: KRX API ë³€ê²½

**í™•ë¥ **: ë‚®ìŒ

**ì˜í–¥**: ë†’ìŒ

**ëŒ€ì‘ ë°©ì•ˆ**:
- í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ì •ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ (CI/CD)
- API ì‘ë‹µ ë³€í™” ê°ì§€ ë¡œì§
- ë²„ì „ë³„ íŒŒì„œ êµ¬í˜„

---

### ë¦¬ìŠ¤í¬ 2: ì„±ëŠ¥ ì´ìŠˆ

**í™•ë¥ **: ì¤‘ê°„

**ì˜í–¥**: ì¤‘ê°„

**ëŒ€ì‘ ë°©ì•ˆ**:
- ì´ˆê¸° ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ë¡œ ì¡°ê¸° ë°œê²¬
- ìºì‹± ì „ëµ ë„ì…
- ë³‘ë ¬ ìš”ì²­ ê³ ë ¤

---

### ë¦¬ìŠ¤í¬ 3: ë°ì´í„° ì •í•©ì„± ë¬¸ì œ

**í™•ë¥ **: ì¤‘ê°„

**ì˜í–¥**: ë†’ìŒ

**ëŒ€ì‘ ë°©ì•ˆ**:
- pykrxì™€ ì§€ì†ì ì¸ ì¶œë ¥ ë¹„êµ
- ì‹¤ì œ KRX ì›¹ì‚¬ì´íŠ¸ì™€ êµì°¨ ê²€ì¦
- ë°ì´í„° ê²€ì¦ ë¡œì§ ì¶”ê°€

---

### ë¦¬ìŠ¤í¬ 4: íœ´ì¼ ë° ì—£ì§€ ì¼€ì´ìŠ¤

**í™•ë¥ **: ë†’ìŒ

**ì˜í–¥**: ë‚®ìŒ

**ëŒ€ì‘ ë°©ì•ˆ**:
- íœ´ì¼ ë‹¬ë ¥ êµ¬í˜„
- ì—£ì§€ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±
- ëª…í™•í•œ ì˜¤ë¥˜ ë©”ì‹œì§€

---

## íŒ€ êµ¬ì„± ë° ì—­í• 

### 1ì¸ ê°œë°œ ì‹œë‚˜ë¦¬ì˜¤

**ìš°ì„ ìˆœìœ„**:
1. Phase 1 (MDCSTAT04701) - 2ì£¼
2. Phase 3 (ë°±í…ŒìŠ¤íŠ¸ ì§€ì›) - 2ì£¼
3. Phase 4 (ë‚˜ë¨¸ì§€ ì—”ë“œí¬ì¸íŠ¸) - 2ì£¼
4. Phase 5 (í…ŒìŠ¤íŠ¸ ë° ë¬¸ì„œí™”) - 1ì£¼

**ì´ ê¸°ê°„**: 7ì£¼

---

### 2ì¸ íŒ€ ì‹œë‚˜ë¦¬ì˜¤

**ê°œë°œì A**:
- Phase 1 (MDCSTAT04701)
- Phase 3 (ë°±í…ŒìŠ¤íŠ¸ ì§€ì›)

**ê°œë°œì B**:
- Phase 2 (ì¶”ê°€ ì—”ë“œí¬ì¸íŠ¸)
- Phase 4 (ë‚˜ë¨¸ì§€ ì—”ë“œí¬ì¸íŠ¸)

**ê³µë™**:
- Phase 5 (í…ŒìŠ¤íŠ¸ ë° ë¬¸ì„œí™”)

**ì´ ê¸°ê°„**: 4-5ì£¼

---

## ë„êµ¬ ë° í™˜ê²½

### ê°œë°œ í™˜ê²½

- **IDE**: IntelliJ IDEA
- **JDK**: 21 (LTS)
- **Kotlin**: 2.2.20
- **Build Tool**: Gradle 8.x

### í…ŒìŠ¤íŒ… ë„êµ¬

- **Unit Test**: JUnit 5
- **Mocking**: MockK
- **Integration Test**: Spring Boot Test
- **Performance Test**: JMH

### CI/CD

- **CI**: GitHub Actions
- **ì½”ë“œ í’ˆì§ˆ**: Detekt, Ktlint
- **ì»¤ë²„ë¦¬ì§€**: JaCoCo

---

## ë‹¤ìŒ ë‹¨ê³„

### ì¦‰ì‹œ ì‹œì‘

1. **Phase 1.1**: `NormalizationExtensions.kt` êµ¬í˜„
2. **í™˜ê²½ ì„¤ì •**: ê°œë°œ í™˜ê²½ êµ¬ì¶• ì™„ë£Œ
3. **í…ŒìŠ¤íŠ¸ ë°ì´í„°**: ëŒ€í‘œ ETF í‹°ì»¤ ëª©ë¡ ì¤€ë¹„

### 1ì£¼ ë‚´

1. **Phase 1.2**: `ComprehensiveEtfInfo.kt` ëª¨ë¸ ì™„ì„±
2. **Phase 1.3**: `EtfComprehensiveService.kt` ì„œë¹„ìŠ¤ êµ¬í˜„

### 2ì£¼ ë‚´

1. **Phase 1.4**: í†µí•© í…ŒìŠ¤íŠ¸ ì™„ë£Œ
2. **Phase 1 ì™„ë£Œ**: MDCSTAT04701 ì „ì²´ ê¸°ëŠ¥ ì‘ë™

---

## ì°¸ì¡°

- 01-í”„ë¡œì íŠ¸-ê°œìš”.md: ì•„í‚¤í…ì²˜ ì„¤ê³„
- 02-KRX-ETF-ì—”ë“œí¬ì¸íŠ¸-ë¶„ì„.md: ì—”ë“œí¬ì¸íŠ¸ ìƒì„¸ ëª…ì„¸
- 03-MDCSTAT04701-ìƒì„¸ëª…ì„¸.md: êµ¬í˜„ ê°€ì´ë“œ
- 04-ë°ì´í„°-ë§¤í•‘-ëª…ì„¸.md: ì •ê·œí™” ê·œì¹™
- 06-API-ì„¤ê³„.md: Public API ì„¤ê³„
- 07-í…ŒìŠ¤íŠ¸-ì „ëµ.md: í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
