# 테스트 개발 체크리스트

## 개요

이 문서는 kfc 프로젝트의 테스트 개발을 단계별로 진행하기 위한 종합 체크리스트입니다.
각 단계를 순서대로 완료하면서 체크 표시를 업데이트하세요.

## Phase 1: 환경 설정 (30분 예상)

### 1.1 디렉토리 구조 생성

```bash
# Live Test 디렉토리
mkdir -p src/liveTest/kotlin/dev/kairoscode/kfc/utils
mkdir -p src/liveTest/kotlin/dev/kairoscode/kfc/live/etf
mkdir -p src/liveTest/kotlin/dev/kairoscode/kfc/live/corp

# Unit Test 디렉토리
mkdir -p src/test/kotlin/dev/kairoscode/kfc/utils
mkdir -p src/test/kotlin/dev/kairoscode/kfc/api/etf
mkdir -p src/test/kotlin/dev/kairoscode/kfc/api/corp

# Test Resources 디렉토리
mkdir -p src/test/resources/responses/etf/{list,comprehensive,daily_prices,ohlcv,adjusted_ohlcv,price_changes,portfolio,tracking_error,divergence_rate,investor_trading,short}
mkdir -p src/test/resources/responses/corp/{corp_code,dividend,stock_split,disclosure}
```

- [ ] Live Test 디렉토리 생성 완료
- [ ] Unit Test 디렉토리 생성 완료
- [ ] Test Resources 디렉토리 생성 완료

### 1.2 API 키 설정

- [ ] `local.properties` 파일 생성
- [ ] OPENDART API 키 발급 및 등록
  ```properties
  OPENDART_API_KEY=your-api-key-here
  ```
- [ ] `.gitignore`에 `local.properties` 추가 확인

### 1.3 build.gradle.kts 설정

참고: `05-build_gradle_설정.md`

- [ ] Live Test Source Set 추가
- [ ] Live Test Configuration 추가
- [ ] Live Test Task 생성 (`liveTest`)
- [ ] Clean Live Test Task 생성 (`cleanLiveTest`)
- [ ] Unit Test Task 설정 (live 태그 제외)
- [ ] 설정 검증: `./gradlew tasks --group verification`

## Phase 2: 헬퍼 클래스 작성 (1-2시간 예상)

참고: `02-헬퍼_클래스_작성_가이드.md`

### 2.1 Live Test 헬퍼 클래스

- [ ] `LiveTestBase.kt` 작성
  - 위치: `src/liveTest/kotlin/dev/kairoscode/kfc/utils/`
  - 기능: API 키 로드, KfcClient 초기화, 테스트 실행 헬퍼

- [ ] `ResponseRecorder.kt` 작성
  - 위치: `src/liveTest/kotlin/dev/kairoscode/kfc/utils/`
  - 기능: API 응답을 JSON 파일로 저장

- [ ] `RecordingConfig.kt` 작성
  - 위치: `src/liveTest/kotlin/dev/kairoscode/kfc/utils/`
  - 기능: 레코딩 설정 및 경로 관리

- [ ] `TestSymbols.kt` 작성
  - 위치: `src/liveTest/kotlin/dev/kairoscode/kfc/utils/`
  - 기능: 테스트용 ETF/종목 코드 상수

### 2.2 Unit Test 헬퍼 클래스

- [ ] `UnitTestBase.kt` 작성
  - 위치: `src/test/kotlin/dev/kairoscode/kfc/utils/`
  - 기능: Mock HTTP Client 주입, JSON 로드 헬퍼

- [ ] `MockHttpClientFactory.kt` 작성
  - 위치: `src/test/kotlin/dev/kairoscode/kfc/utils/`
  - 기능: Mock HTTP Client 생성

- [ ] `JsonResponseLoader.kt` 작성
  - 위치: `src/test/kotlin/dev/kairoscode/kfc/utils/`
  - 기능: JSON 파일 로드

- [ ] `TestExtensions.kt` 작성
  - 위치: `src/test/kotlin/dev/kairoscode/kfc/utils/`
  - 기능: 테스트용 확장 함수 (assert 헬퍼)

### 2.3 헬퍼 클래스 검증

- [ ] 빌드 성공 확인: `./gradlew build`
- [ ] 컴파일 에러 없음 확인

## Phase 3: Live Test 작성 (4-6시간 예상)

참고: `03-EtfApi_테스트_계획.md`, `04-CorpApi_테스트_계획.md`

### 3.1 EtfApi Live Test (10개 파일)

각 파일 위치: `src/liveTest/kotlin/dev/kairoscode/kfc/live/etf/`

- [ ] `EtfListLiveTest.kt` - ETF 목록 조회
- [ ] `EtfComprehensiveLiveTest.kt` - ETF 종합 정보
- [ ] `EtfDailyPricesLiveTest.kt` - 전체 ETF 일별 시세
- [ ] `EtfOhlcvLiveTest.kt` - ETF OHLCV 조회
- [ ] `EtfAdjustedOhlcvLiveTest.kt` - 수정 OHLCV 조회
- [ ] `EtfPriceChangesLiveTest.kt` - ETF 등락률
- [ ] `EtfPortfolioLiveTest.kt` - ETF 포트폴리오
- [ ] `EtfPerformanceLiveTest.kt` - 추적오차/괴리율
- [ ] `EtfInvestorTradingLiveTest.kt` - 투자자별 매매동향
- [ ] `EtfShortLiveTest.kt` - 공매도 현황

### 3.2 CorpApi Live Test (4개 파일)

각 파일 위치: `src/liveTest/kotlin/dev/kairoscode/kfc/live/corp/`

- [ ] `CorpCodeLiveTest.kt` - 법인 코드 목록
- [ ] `DividendLiveTest.kt` - 배당 정보
- [ ] `StockSplitLiveTest.kt` - 액면분할/병합
- [ ] `DisclosureLiveTest.kt` - 공시 검색

### 3.3 Live Test 실행 및 레코딩

- [ ] Live Test 실행 (레코딩 없이): `./gradlew liveTest`
- [ ] Live Test 실행 (레코딩): `./gradlew liveTest -Precord.responses=true`
- [ ] 레코딩된 JSON 파일 확인: `src/test/resources/responses/`
- [ ] 레코딩 데이터 품질 검증 (빈 배열, null 값 확인)

## Phase 4: Unit Test 작성 (4-6시간 예상)

참고: `03-EtfApi_테스트_계획.md`, `04-CorpApi_테스트_계획.md`

### 4.1 EtfApi Unit Test (12개 파일)

각 파일 위치: `src/test/kotlin/dev/kairoscode/kfc/api/etf/`

- [ ] `EtfListApiSpec.kt` - ETF 목록 조회
- [ ] `EtfComprehensiveApiSpec.kt` - ETF 종합 정보
- [ ] `EtfDailyPricesApiSpec.kt` - 전체 ETF 일별 시세
- [ ] `EtfOhlcvApiSpec.kt` - ETF OHLCV 조회
- [ ] `EtfAdjustedOhlcvApiSpec.kt` - 수정 OHLCV 조회
- [ ] `EtfPriceChangesApiSpec.kt` - ETF 등락률
- [ ] `EtfPortfolioApiSpec.kt` - ETF 포트폴리오
- [ ] `EtfTrackingErrorApiSpec.kt` - 추적오차
- [ ] `EtfDivergenceRateApiSpec.kt` - 괴리율
- [ ] `EtfInvestorTradingApiSpec.kt` - 투자자별 매매동향
- [ ] `EtfShortApiSpec.kt` - 공매도 현황

### 4.2 CorpApi Unit Test (4개 파일)

각 파일 위치: `src/test/kotlin/dev/kairoscode/kfc/api/corp/`

- [ ] `CorpCodeApiSpec.kt` - 법인 코드 목록
- [ ] `DividendApiSpec.kt` - 배당 정보
- [ ] `StockSplitApiSpec.kt` - 액면분할/병합
- [ ] `DisclosureApiSpec.kt` - 공시 검색

### 4.3 Unit Test 실행

- [ ] 전체 Unit Test 실행: `./gradlew test`
- [ ] 테스트 결과 확인: `build/reports/tests/test/index.html`
- [ ] 모든 테스트 통과 확인

## Phase 5: 테스트 커버리지 검증 (1-2시간 예상)

### 5.1 기능별 테스트 커버리지

**EtfApi (15개 함수)**
- [ ] `getList()` - Live Test + Unit Test 완료
- [ ] `getComprehensiveInfo()` - Live Test + Unit Test 완료
- [ ] `getAllDailyPrices()` - Live Test + Unit Test 완료
- [ ] `getOhlcv()` - Live Test + Unit Test 완료
- [ ] `getAdjustedOhlcv()` - Live Test + Unit Test 완료
- [ ] `getPriceChanges()` - Live Test + Unit Test 완료
- [ ] `getPortfolio()` - Live Test + Unit Test 완료
- [ ] `getTrackingError()` - Live Test + Unit Test 완료
- [ ] `getDivergenceRate()` - Live Test + Unit Test 완료
- [ ] `getAllInvestorTrading()` - Live Test + Unit Test 완료
- [ ] `getInvestorTradingByDate()` - Live Test + Unit Test 완료
- [ ] `getInvestorTradingByDateRange()` - Live Test + Unit Test 완료
- [ ] `getInvestorTradingByIsin()` - Live Test + Unit Test 완료
- [ ] `getShortSellingByDate()` - Live Test + Unit Test 완료
- [ ] `getShortBalanceByDate()` - Live Test + Unit Test 완료

**CorpApi (4개 함수)**
- [ ] `getCorpCodeList()` - Live Test + Unit Test 완료
- [ ] `getDividendInfo()` - Live Test + Unit Test 완료
- [ ] `getStockSplitInfo()` - Live Test + Unit Test 완료
- [ ] `searchDisclosures()` - Live Test + Unit Test 완료

### 5.2 시나리오별 테스트 커버리지

- [ ] 기본 사용 시나리오 (Basic Usage)
- [ ] 활용 시나리오 (Use Cases)
- [ ] API 명세 시나리오 (Specifications)
- [ ] 에러 처리 시나리오 (Error Handling)

### 5.3 테스트 품질 검증

- [ ] 모든 테스트에 `@DisplayName` 추가됨
- [ ] Given-When-Then 패턴 적용됨
- [ ] 적절한 Assertion 사용됨
- [ ] 테스트 코드가 API 사용법을 설명함 (Living Documentation)

## Phase 6: 문서화 및 정리 (1시간 예상)

### 6.1 README.md 업데이트

- [ ] 테스트 섹션 추가
- [ ] Live Test 실행 방법 설명
- [ ] Unit Test 실행 방법 설명
- [ ] 레코딩 데이터 관리 방법 설명

### 6.2 .gitignore 확인

- [ ] `local.properties` 무시 확인
- [ ] `build/reports/` 무시 확인
- [ ] `build/test-results/` 무시 확인
- [ ] `.idea/`, `.gradle/` 무시 확인

### 6.3 CI/CD 설정 (선택사항)

- [ ] GitHub Actions 워크플로우 추가
- [ ] Unit Test 자동 실행 설정
- [ ] 테스트 결과 리포트 생성

## Phase 7: 최종 검증 (30분 예상)

### 7.1 전체 테스트 실행

```bash
# 1. Clean Build
./gradlew clean

# 2. Unit Test 실행
./gradlew test

# 3. Live Test 실행 (레코딩 없이)
./gradlew liveTest

# 4. 전체 실행 (Unit Test + Live Test)
./gradlew test liveTest
```

- [ ] Clean Build 성공
- [ ] Unit Test 전체 통과
- [ ] Live Test 전체 통과
- [ ] 빌드 에러 없음

### 7.2 코드 리뷰

- [ ] 테스트 코드 스타일 일관성 확인
- [ ] 불필요한 주석 제거
- [ ] Import 정리
- [ ] 코드 포맷팅 적용

### 7.3 최종 확인

- [ ] 모든 체크리스트 항목 완료
- [ ] 테스트 문서 최신화
- [ ] Git 커밋 준비 완료

## 예상 소요 시간 총계

| Phase | 작업 내용 | 예상 시간 |
|-------|----------|----------|
| Phase 1 | 환경 설정 | 30분 |
| Phase 2 | 헬퍼 클래스 작성 | 1-2시간 |
| Phase 3 | Live Test 작성 | 4-6시간 |
| Phase 4 | Unit Test 작성 | 4-6시간 |
| Phase 5 | 커버리지 검증 | 1-2시간 |
| Phase 6 | 문서화 | 1시간 |
| Phase 7 | 최종 검증 | 30분 |
| **총계** | | **12-18시간** |

## 참고 문서

- `00-테스트_전략_개요.md` - 테스트 전략 및 아키텍처
- `01-디렉토리_구조.md` - 디렉토리 구조 및 파일 조직
- `02-헬퍼_클래스_작성_가이드.md` - 헬퍼 클래스 구현 가이드
- `03-EtfApi_테스트_계획.md` - EtfApi 테스트 시나리오
- `04-CorpApi_테스트_계획.md` - CorpApi 테스트 시나리오
- `05-build_gradle_설정.md` - Gradle 빌드 설정

## 트러블슈팅

### API 키 오류
```
ℹ️  OPENDART_API_KEY가 설정되지 않았습니다.
```
→ `local.properties`에 API 키를 추가하세요.

### Rate Limiting 오류
```
429 Too Many Requests
```
→ Live Test 실행 시 `maxParallelForks = 1` 설정을 확인하세요.
→ API 호출 사이에 적절한 딜레이를 추가하세요.

### 레코딩 실패
```
⚠️ 경고: etf/list 에 레코딩할 데이터가 없습니다.
```
→ API 응답이 비어있는지 확인하세요.
→ API 호출이 성공했는지 확인하세요.

### JSON 파일 로드 실패
```
IllegalArgumentException: 테스트 리소스를 찾을 수 없습니다: responses/etf/list/etf_list.json
```
→ Live Test로 먼저 레코딩을 생성했는지 확인하세요.
→ 파일 경로가 올바른지 확인하세요.

## 다음 단계

테스트 개발이 완료되면:

1. 테스트 리포트를 생성하여 커버리지 확인
2. 지속적 통합(CI) 파이프라인에 테스트 추가
3. 정기적인 Live Test 실행으로 레코딩 데이터 갱신
4. 새로운 API 추가 시 테스트도 함께 작성
