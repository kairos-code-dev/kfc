# kotlin-krx 확장 전략

> **목적**: 채권/주식 데이터 추가 시 확장 로드맵 및 전략 정의
> **작성일**: 2025-01-19
> **버전**: v1.0

---

## 목차

1. [확장 개요](#1-확장-개요)
2. [Phase 1: v1.0.0 (ETF)](#2-phase-1-v100-etf)
3. [Phase 2: v1.1.0 (KRX 채권)](#3-phase-2-v110-krx-채권)
4. [Phase 3: v1.2.0 (KRX 주식)](#4-phase-3-v120-krx-주식)
5. [Phase 4: v2.0.0 (Naver 주식)](#5-phase-4-v200-naver-주식)
6. [확장 영향 범위](#6-확장-영향-범위)
7. [하위 호환성 전략](#7-하위-호환성-전략)

---

## 1. 확장 개요

### 1.1 확장 방향

kotlin-krx는 소스별 분류 구조를 채택하여 다음과 같이 확장됩니다:

```
v1.0.0 (현재)          v1.1.0 (채권)         v1.2.0 (주식)
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ KRX ETF      │ ───▶ │ KRX ETF      │ ───▶ │ KRX ETF      │
│ Naver ETF    │      │ Naver ETF    │      │ Naver ETF    │
│ OPENDART     │      │ OPENDART     │      │ OPENDART     │
└──────────────┘      │ KRX Bond ✨  │      │ KRX Bond     │
                      └──────────────┘      │ KRX Stock ✨ │
                                            │ Naver Stock  │
                                            └──────────────┘
```

### 1.2 설계 원칙

**소스별 독립성**:
- KRX 채권 추가 시 Naver, OPENDART 영향 없음
- 각 소스는 독립적으로 진화 가능

**Facade 패턴 유지**:
- 새로운 API 추가 시 Facade만 업데이트
- 기존 사용자 코드 영향 최소화

**하위 호환성**:
- Minor 버전 (v1.x.0): 새 기능 추가, 하위 호환 유지
- Major 버전 (v2.0.0): Breaking Change 허용

---

## 2. Phase 1: v1.0.0 (ETF)

### 2.1 현재 구조

**API 인터페이스**:
```kotlin
package dev.kairoscode.kfc.api

// Facade
interface KfcClient {
    val krx: KrxApi
    val naver: NaverApi
    val openDart: OpenDartApi
}

interface KrxApi {
    val etf: KrxEtfApi
}

interface NaverApi {
    val etf: NaverEtfApi
}
```

**제공 기능**:
- KRX ETF API: 15 함수
- Naver ETF API: 1 함수
- OPENDART API: 6 함수

**패키지 구조**:
```
api/krx/KrxEtfApi.kt
api/naver/NaverEtfApi.kt
api/opendart/OpenDartApi.kt
api/KrxApiClient.kt

model/krx/etf/
model/naver/etf/
model/opendart/
model/common/

internal/krx/etf/
internal/naver/etf/
internal/opendart/
internal/http/
```

---

## 3. Phase 2: v1.1.0 (KRX 채권)

### 3.1 추가 사항

**신규 API**:
```kotlin
package dev.kairoscode.kfc.api.krx

interface KrxBondApi {
    suspend fun getBondList(): List<BondListItem>
    suspend fun getBondDetail(isin: String, date: LocalDate): BondDetail
    suspend fun getBondYield(isin: String, fromDate: LocalDate, toDate: LocalDate): List<BondYield>
    // ... 약 10~15개 함수 예상
}
```

**Facade 업데이트**:
```kotlin
interface KrxApi {
    val etf: KrxEtfApi
    val bond: KrxBondApi  // 추가
}
```

**신규 모델**:
```kotlin
package dev.kairoscode.kfc.model.krx.bond

data class BondListItem(
    val isin: String,
    val name: String,
    val issueDate: LocalDate,
    val maturityDate: LocalDate,
    val couponRate: BigDecimal,
    val issuer: String
)

data class BondDetail(
    val isin: String,
    val name: String,
    val issueDate: LocalDate,
    val maturityDate: LocalDate,
    val couponRate: BigDecimal,
    val faceValue: Long,
    val currentPrice: Int,
    val yield: BigDecimal,
    val rating: String
)

data class BondYield(
    val tradeDate: LocalDate,
    val yield: BigDecimal,
    val price: Int,
    val volume: Long
)
```

**신규 내부 구현**:
```
internal/krx/bond/
├── KrxBondApiImpl.kt
├── KrxBondDataParser.kt
└── KrxBondTypeConverter.kt
```

### 3.2 KRX 채권 API 엔드포인트 (예상)

| 함수 | KRX 엔드포인트 | 설명 |
|-----|---------------|------|
| `getBondList()` | MDC30011000 | 전체 채권 목록 |
| `getBondDetail()` | MDC30012000 | 개별 채권 상세 정보 |
| `getBondYield()` | MDC30013000 | 수익률 내역 |
| `getBondPrice()` | MDC30014000 | 시세 내역 |
| `getBondTransaction()` | MDC30015000 | 거래량 내역 |

**Note**: 실제 엔드포인트는 KRX API 문서 확인 필요

### 3.3 영향 범위

**변경됨**:
- ✅ `api/KrxApiClient.kt` (Facade 업데이트)
- ✅ `api/krx/KrxBondApi.kt` (신규)
- ✅ `model/krx/bond/` (신규 패키지)
- ✅ `internal/krx/bond/` (신규 패키지)

**영향 없음**:
- ✅ `api/krx/KrxEtfApi.kt` (기존 유지)
- ✅ `api/naver/` (기존 유지)
- ✅ `api/opendart/` (기존 유지)
- ✅ 기존 사용자 코드 (하위 호환)

### 3.4 사용 예시

```kotlin
// 기존 코드 (v1.0.0) - 계속 동작
val client = KfcClient.create()
val etfList = client.krx.etf.getEtfList()

// 신규 코드 (v1.1.0)
val bondList = client.krx.bond.getBondList()
val bondDetail = client.krx.bond.getBondDetail("KR103501GBC0", LocalDate.now())
```

---

## 4. Phase 3: v1.2.0 (KRX 주식)

### 4.1 추가 사항

**신규 API**:
```kotlin
package dev.kairoscode.kfc.api.krx

interface KrxStockApi {
    suspend fun getStockList(): List<StockListItem>
    suspend fun getStockDetail(ticker: String, date: LocalDate): StockDetail
    suspend fun getStockOhlcv(ticker: String, fromDate: LocalDate, toDate: LocalDate): List<StockOhlcv>
    suspend fun getStockInvestorTrading(ticker: String, fromDate: LocalDate, toDate: LocalDate): List<InvestorTrading>
    // ... 약 15~20개 함수 예상
}
```

**Facade 업데이트**:
```kotlin
interface KrxApi {
    val etf: KrxEtfApi
    val bond: KrxBondApi
    val stock: KrxStockApi  // 추가
}
```

**신규 모델**:
```kotlin
package dev.kairoscode.kfc.model.krx.stock

data class StockListItem(
    val ticker: String,
    val name: String,
    val marketType: String,  // KOSPI/KOSDAQ
    val sector: String,
    val listedShares: Long
)

data class StockDetail(
    val ticker: String,
    val name: String,
    val marketType: String,
    val sector: String,
    val closePrice: Int,
    val changePrice: Int,
    val changeRate: BigDecimal,
    val volume: Long,
    val marketCap: Long,
    val per: BigDecimal?,
    val pbr: BigDecimal?,
    val eps: Int?,
    val bps: Int?
)

data class StockOhlcv(
    val tradeDate: LocalDate,
    val openPrice: Int,
    val highPrice: Int,
    val lowPrice: Int,
    val closePrice: Int,
    val volume: Long,
    val tradingValue: Long
)
```

### 4.2 KRX 주식 API 엔드포인트 (예상)

| 함수 | KRX 엔드포인트 | 설명 |
|-----|---------------|------|
| `getStockList()` | MDC01010100 | 전체 주식 목록 |
| `getStockDetail()` | MDC01020100 | 개별 주식 상세 정보 |
| `getStockOhlcv()` | MDC01030100 | OHLCV 내역 |
| `getStockInvestorTrading()` | MDC01040100 | 투자자별 거래 내역 |
| `getStockForeignHolding()` | MDC01050100 | 외국인 보유 현황 |

**Note**: 실제 엔드포인트는 KRX API 문서 확인 필요

### 4.3 영향 범위

**변경됨**:
- ✅ `api/KrxApiClient.kt` (Facade 업데이트)
- ✅ `api/krx/KrxStockApi.kt` (신규)
- ✅ `model/krx/stock/` (신규 패키지)
- ✅ `internal/krx/stock/` (신규 패키지)
- ✅ `model/common/` (Ohlcv 공통 모델 재사용 가능)

**영향 없음**:
- ✅ 기존 ETF, 채권 코드 (하위 호환)

---

## 5. Phase 4: v2.0.0 (Naver 주식)

### 5.1 추가 사항

**신규 API**:
```kotlin
package dev.kairoscode.kfc.api.naver

interface NaverStockApi {
    suspend fun getStockDailyPrice(ticker: String, fromDate: LocalDate, toDate: LocalDate): List<StockDailyPrice>
    suspend fun getStockIntraday(ticker: String, date: LocalDate): List<StockIntradayTick>
}
```

**Facade 업데이트**:
```kotlin
interface NaverApi {
    val etf: NaverEtfApi
    val stock: NaverStockApi  // 추가
}
```

**신규 모델**:
```kotlin
package dev.kairoscode.kfc.model.naver.stock

data class StockDailyPrice(
    val tradeDate: LocalDate,
    val openPrice: Int,
    val highPrice: Int,
    val lowPrice: Int,
    val closePrice: Int,
    val volume: Long
)

data class StockIntradayTick(
    val time: LocalTime,
    val price: Int,
    val volume: Long
)
```

### 5.2 Breaking Change (v2.0.0)

**변경 이유**: Naver API 구조 개선

**변경 사항**:
```kotlin
// v1.x.x (Old)
interface NaverEtfApi {
    suspend fun getAdjustedClose(...): List<AdjustedClose>
}

// v2.0.0 (New)
interface NaverEtfApi {
    suspend fun getEtfDailyPrice(...): List<EtfDailyPrice>  // 이름 변경
}
```

**Deprecation 전략**:
```kotlin
@Deprecated(
    message = "Use getEtfDailyPrice instead",
    replaceWith = ReplaceWith("getEtfDailyPrice(ticker, fromDate, toDate)")
)
suspend fun getAdjustedClose(...): List<AdjustedClose> {
    return getEtfDailyPrice(...).map { ... }  // 내부적으로 새 함수 호출
}
```

---

## 6. 확장 영향 범위

### 6.1 영향 범위 매트릭스

| Phase | 변경 사항 | ETF 영향 | 채권 영향 | 주식 영향 | Breaking Change |
|-------|---------|---------|----------|----------|----------------|
| v1.0.0 | ETF 구현 | ✅ 신규 | - | - | 없음 |
| v1.1.0 | KRX 채권 추가 | ⚪ 없음 | ✅ 신규 | - | 없음 |
| v1.2.0 | KRX 주식 추가 | ⚪ 없음 | ⚪ 없음 | ✅ 신규 | 없음 |
| v2.0.0 | Naver 주식 + 리팩토링 | ⚠️ 함수명 변경 | ⚪ 없음 | ✅ 신규 | 있음 (Deprecation) |

### 6.2 패키지 확장 타임라인

```
v1.0.0 (2025 Q1)
├── api/krx/KrxEtfApi.kt
├── api/naver/NaverEtfApi.kt
├── api/opendart/OpenDartApi.kt
└── api/KrxApiClient.kt

v1.1.0 (2025 Q2)
├── api/krx/KrxEtfApi.kt
├── api/krx/KrxBondApi.kt ✨
├── api/naver/NaverEtfApi.kt
├── api/opendart/OpenDartApi.kt
└── api/KrxApiClient.kt

v1.2.0 (2025 Q3)
├── api/krx/KrxEtfApi.kt
├── api/krx/KrxBondApi.kt
├── api/krx/KrxStockApi.kt ✨
├── api/naver/NaverEtfApi.kt
├── api/opendart/OpenDartApi.kt
└── api/KrxApiClient.kt

v2.0.0 (2025 Q4)
├── api/krx/KrxEtfApi.kt
├── api/krx/KrxBondApi.kt
├── api/krx/KrxStockApi.kt
├── api/naver/NaverEtfApi.kt (⚠️ 리팩토링)
├── api/naver/NaverStockApi.kt ✨
├── api/opendart/OpenDartApi.kt
└── api/KrxApiClient.kt
```

---

## 7. 하위 호환성 전략

### 7.1 Semantic Versioning

**Major (v2.0.0)**: Breaking Changes
- 함수 시그니처 변경
- 패키지 구조 변경
- 모델 필드 삭제

**Minor (v1.x.0)**: 새 기능 추가 (하위 호환)
- 새 API 추가
- 새 함수 추가
- 새 모델 추가
- Optional 파라미터 추가

**Patch (v1.0.x)**: 버그 수정
- 파싱 버그 수정
- 타입 변환 버그 수정
- 예외 처리 개선

### 7.2 Deprecation 주기

**v1.x.x**: Deprecation 선언
```kotlin
@Deprecated(
    message = "Use newFunction instead",
    replaceWith = ReplaceWith("newFunction(param)"),
    level = DeprecationLevel.WARNING
)
fun oldFunction(param: String)
```

**v2.0.0**: Deprecation 유지 (6개월)
```kotlin
@Deprecated(
    message = "Use newFunction instead. Will be removed in v3.0.0",
    replaceWith = ReplaceWith("newFunction(param)"),
    level = DeprecationLevel.WARNING
)
fun oldFunction(param: String)
```

**v3.0.0**: 완전 제거

### 7.3 마이그레이션 가이드 제공

각 Major 버전마다 마이그레이션 가이드 문서 제공:

```markdown
# v1.x.x → v2.0.0 마이그레이션 가이드

## Breaking Changes

### 1. NaverEtfApi 함수명 변경

**Before (v1.x.x)**:
```kotlin
val data = client.naver.etf.getAdjustedClose(ticker, fromDate, toDate)
```

**After (v2.0.0)**:
```kotlin
val data = client.naver.etf.getEtfDailyPrice(ticker, fromDate, toDate)
```

### 2. 모델 변경

**Before**:
```kotlin
data class AdjustedClose(...)
```

**After**:
```kotlin
data class EtfDailyPrice(...)
```
```

---

## 요약

### 확장 로드맵

1. **v1.0.0 (현재)**: ETF 전용
2. **v1.1.0**: + KRX 채권
3. **v1.2.0**: + KRX 주식
4. **v2.0.0**: + Naver 주식 + Breaking Changes

### 핵심 전략

- ✅ **소스별 분류**: 각 소스 독립적 확장
- ✅ **Facade 패턴**: 새 API 추가 시 Facade만 업데이트
- ✅ **하위 호환성**: Minor 버전은 하위 호환 유지
- ✅ **Deprecation**: 6개월 주기로 안전하게 제거
- ✅ **마이그레이션 가이드**: 각 Major 버전마다 제공

---

**작성일**: 2025-01-19
**버전**: v1.0
**작성자**: kotlin-krx 프로젝트
